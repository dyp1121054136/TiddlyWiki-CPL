{"type":"application/json","text":"{\"tiddlers\":{\"$:/plugins/jmh/mermaid/filter.js\":{\"title\":\"$:/plugins/jmh/mermaid/filter.js\",\"text\":\"/*\\\\\\ncreated: 20211217030345055\\ntype: application/javascript\\ntitle: $:/plugins/jmh/mermaid/filter.js\\ntags: \\nmodified: 20211221121841137\\nmodule-type: filteroperator\\n\\nA filter to encode and decode base64\\n\\n@preserve\\n\\\\*/\\n(function () {\\n    \\\"use strict\\\";\\n    exports.mermaid = function (e, r, t) {\\n        var n = r.operand;\\n        try {var outstr = atob(n.replace(/.*\\\\/#/,\\\"\\\").replaceAll(\\\"_\\\",\\\"/\\\").replaceAll('-','+'));} catch(i) {var outstr= \\\"\\\" }\\n\\n        try {\\n            switch(r.suffix) {\\n              case \\\"removeapocode\\\":\\n                n = \\\"\\\";\\n                e(function(e,r){n+=r});\\n                n = n.replaceAll(\\\"\\\\\\\\'\\\",\\\"'\\\");\\n                break;\\n              case \\\"encode\\\":\\n                n = btoa(n).replaceAll(\\\"/\\\",\\\"_\\\");\\n                break;\\n              case \\\"getcode\\\":\\n                try {\\n                    n = JSON.parse(outstr).code;\\n                } catch (i) {\\n                    return [];\\n                }\\n                break;\\n              case \\\"gettheme\\\":\\n                try {\\n                    n = JSON.parse(JSON.parse(outstr).mermaid).theme;\\n                } catch (i) {\\n                    return [\\\"default\\\"];\\n                }\\n                break;\\n              case \\\"getthemevars\\\":\\n                try {\\n                    n = JSON.stringify(JSON.parse(JSON.parse(outstr).mermaid).themeVariables).substring(1).slice(0, -1);;\\n                } catch (i) {\\n                    return [\\\"\\\"];\\n                }\\n                break;\\n              default:\\n                n = \\\"Mermaid filter requires a valid suffix.\\\"\\n            }\\n        } catch (i) {\\n            return [\\\"Error in mermaid filter:\\\\n\\\" + i];\\n        }\\n        return [n];\\n    };\\n})();\\n\",\"created\":\"20211217030345055\",\"type\":\"application/javascript\",\"tags\":\"\",\"modified\":\"20211221121841137\",\"module-type\":\"filteroperator\"},\"$:/plugins/jmh/mermaid/history\":{\"title\":\"$:/plugins/jmh/mermaid/history\",\"created\":\"20211219211827533\",\"modified\":\"20211219211942994\",\"tags\":\"\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"* ''0.1'' -- initial release.\"},\"$:/plugins/jmh/mermaid/license\":{\"title\":\"$:/plugins/jmh/mermaid/license\",\"created\":\"20211219211827536\",\"modified\":\"20211219211939242\",\"tags\":\"\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"MIT License\\n\\nCopyright (c) 2021 Jason M. Houle\\n\\nPermission is hereby granted, free of charge, to any person obtaining a copy\\nof this software and associated documentation files (the \\\"Software\\\"), to deal\\nin the Software without restriction, including without limitation the rights\\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\\ncopies of the Software, and to permit persons to whom the Software is\\nfurnished to do so, subject to the following conditions:\\n\\nThe above copyright notice and this permission notice shall be included in all\\ncopies or substantial portions of the Software.\\n\\nTHE SOFTWARE IS PROVIDED \\\"AS IS\\\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\\nSOFTWARE.\"},\"$:/plugins/jmh/mermaid/macros-internal\":{\"title\":\"$:/plugins/jmh/mermaid/macros-internal\",\"created\":\"20211219174100358\",\"modified\":\"20211221174333354\",\"tags\":\"\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"\\\\define mermaid_image(tiddler)\\n<div style=\\\"text-align:center\\\">\\n<$wikify name=\\\"base64\\\" text='<<mermaid_encode \\\"$tiddler$\\\">>'>\\n<$wikify name=\\\"imgout\\\" text='{{{ [<base64>addprefix[<object type=\\\"image/svg+xml\\\" width=\\\"100%\\\" data=\\\"https://mermaid.ink/svg/]addsuffix[\\\" />]]  || $:/plugins/jmh/mermaid/templates/text }}}'>\\n<<imgout>>\\n</$wikify>\\n</$wikify>\\n</div>\\n\\\\end\\n\\n\\\\define mermaid_link()\\n<$wikify name=\\\"base64\\\" text='<<mermaid_encode $:/temp/mermaid>>'>\\n<$wikify name=\\\"imgout\\\" text='{{{ [<base64>addprefix[<a href=\\\"https://mermaid-js.github.io/mermaid-live-editor/edit/#]addsuffix[\\\" target=_blank >Edit with Mermaid Live Editor</a>]]  || $:/plugins/jmh/mermaid/templates/text }}}'>\\n<<imgout>>\\n</$wikify>\\n</$wikify>\\n\\\\end\\n\\n\\\\define mermaid_encode(tiddler)\\n<$wikify name=\\\"y\\\" text='<<mermaid_wrap $tiddler$>>'>\\n{{{ [mermaid:encode<y>] || $:/plugins/jmh/mermaid/templates/text }}}\\n</$wikify>\\n\\\\end\\n\\n\\\\define mermaid_wrap(tiddler)\\n{\\\"code\\\":\\\"{{{ [[$tiddler$]get[code]stringify[]mermaid:removeapocode[]]  || $:/plugins/jmh/mermaid/templates/text }}}\\\",\\\"mermaid\\\":{\\\"theme\\\":\\\"{{{ [[$tiddler$]get[theme]]  || $:/plugins/jmh/mermaid/templates/text }}}\\\",\\\"themeVariables\\\": { {{{ [[$tiddler$]get[themeVariables]]  || $:/plugins/jmh/mermaid/templates/text }}} }},\\\"autoSync\\\":true}\\n\\\\end\\n\\n\\\\define mermaid_editor_advanced_toggle()\\n<div class=\\\"advancedDropdown\\\">\\n<$reveal type=\\\"nomatch\\\" state=\\\"$:/temp/mermaid!!advanced\\\" text=\\\"true\\\">\\n<$button set=\\\"$:/temp/mermaid!!advanced\\\" setTo=\\\"true\\\" class=\\\"tc-btn-invisible\\\">\\n{{$:/core/images/unfold-button}} ''Advanced''\\n</$button>\\n</$reveal>\\n<$reveal type=\\\"match\\\" state=\\\"$:/temp/mermaid!!advanced\\\" text=\\\"true\\\"><$button set=\\\"$:/temp/mermaid!!advanced\\\" setTo=\\\"false\\\" class=\\\"tc-btn-invisible\\\">\\n{{$:/core/images/fold-button}} ''Advanced''\\n</$button><br>\\n\\nTheme Variables (<a href=\\\"https://mermaid-js.github.io/mermaid/#/theming\\\">reference</a>)<br>\\n\\n<$edit-text tiddler=\\\"$:/temp/mermaid\\\" field=\\\"themeVariables\\\" tag=\\\"textarea\\\" class=\\\"mermaidTextEdit\\\" />\\n<div style=\\\"font-size:smaller\\\"><i>Enter a comma-separated list of value pairs inside the <code>'themeVariables'</code> curly braces, e.g., <code>\\\"primaryColor\\\": \\\"#ff0000\\\"</code>. Use <b>double-quotes</b> as in the live editor, not single quotes as in the reference docs.</i></div>\\n<hr>\\n\\nLoad base64 output from mermaid.live:<br>\\n\\n<$edit-text tiddler=\\\"$:/temp/mermaid\\\" field=\\\"b64import\\\" tag=\\\"textarea\\\" class=\\\"mermaidTextEdit\\\" placeholder=\\\"Enter mermaid.live reference to decode\\\" /><br>\\n\\n<$set name=\\\"dcbutton\\\" value=<<mermaid_decoder_button>> filter=\\\"[[$:/temp/mermaid]has[b64import]]\\\" emptyValue=\\\"\\\">\\n<<dcbutton>>\\n</$set>\\n\\n</$reveal>\\n</div>\\n\\\\end\\n\\n\\\\define mermaid_decoder_button()\\n<$set name=\\\"vbutton\\\" value=<<mermaid_valid_button>> filter=\\\"[mermaid:getcode{$:/temp/mermaid!!b64import}]\\\" emptyValue=\\\"<span style='color:red'><i>No valid Mermaid.js base64 encoding detected</i>/<span>\\\">\\n<<vbutton>>\\n</$set>\\n\\\\end\\n\\n\\\\define mermaid_valid_button()\\n<$button actions=<<mermaid_decode_and_load>>>Load</$button> <i>Note: this will overwrite all content in this editor.</i>\\n\\\\end\\n\\n\\\\define mermaid_decode_and_load()\\n<$action-setfield $tiddler=\\\"$:/temp/mermaid\\\" code={{{ [mermaid:getcode{$:/temp/mermaid!!b64import}] || $:/plugins/jmh/mermaid/templates/text }}} nosync_code={{{ [mermaid:getcode{$:/temp/mermaid!!b64import}] || $:/plugins/jmh/mermaid/templates/text }}} theme={{{ [mermaid:gettheme{$:/temp/mermaid!!b64import}] || $:/plugins/jmh/mermaid/templates/text }}} themeVariables={{{ [mermaid:getthemevars{$:/temp/mermaid!!b64import}] || $:/plugins/jmh/mermaid/templates/text }}} />\\n\\\\end\\n\\n\\\\define mermaid_codebox()\\n<$reveal type=\\\"match\\\" state=\\\"$:/temp/mermaid!!autosync\\\" text=\\\"true\\\">\\n<$edit-text tiddler=\\\"$:/temp/mermaid\\\" field=\\\"code\\\" tag=\\\"textarea\\\" class=\\\"mermaidTextEdit\\\" />\\n</$reveal>\\n<$reveal type=\\\"nomatch\\\" state=\\\"$:/temp/mermaid!!autosync\\\" text=\\\"true\\\">\\n<$edit-text tiddler=\\\"$:/temp/mermaid\\\" field=\\\"nosync_code\\\" tag=\\\"textarea\\\" class=\\\"mermaidTextEdit\\\" />\\n</$reveal>\\n\\\\end\\n\\n\\\\define mermaid_set_autosync_on()\\n<$action-setfield $tiddler=\\\"$:/temp/mermaid\\\" $field=\\\"code\\\" $value={{$:/temp/mermaid!!nosync_code}} />\\n\\\\end\\n\\n\\\\define mermaid_set_autosync_off()\\n<$action-setfield $tiddler=\\\"$:/temp/mermaid\\\" $field=\\\"nosync_code\\\" $value={{$:/temp/mermaid!!code}} />\\n\\\\end\\n\\n\\\\define mermaid_editor_options()\\n''Theme:'' \\n<$select tiddler=\\\"$:/temp/mermaid\\\" field=\\\"theme\\\" default='Default'>>\\n<option value=\\\"base\\\">Base</option>\\n<option value=\\\"dark\\\">Dark</option>\\n<option value=\\\"default\\\">Default</option>\\n<option value=\\\"forest\\\">Forest</option>\\n<option value=\\\"neutral\\\">Neutral</option>\\n</$select> \\n''Auto sync:'' \\n<$reveal type=\\\"nomatch\\\" state=\\\"$:/temp/mermaid!!autosync\\\" text=\\\"true\\\">\\n<$checkbox tiddler=\\\"$:/temp/mermaid\\\" field=\\\"autosync\\\" checked=\\\"true\\\" unchecked=\\\"false\\\" actions=<<mermaid_set_autosync_on>> />\\n<$button actions=<<mermaid_set_autosync_on>> >\\n{{$:/core/images/refresh-button}}\\n</$button>\\n</$reveal>\\n<$reveal type=\\\"match\\\" state=\\\"$:/temp/mermaid!!autosync\\\" text=\\\"true\\\">\\n<$checkbox tiddler=\\\"$:/temp/mermaid\\\" field=\\\"autosync\\\" checked=\\\"true\\\" unchecked=\\\"false\\\" actions=<<mermaid_set_autosync_off>> />\\n</$reveal>\\n\\\\end\\n\\n\\\\define mermaid_save()\\n<$action-setfield $tiddler={{$:/temp/mermaid!!save_as}} code={{$:/temp/mermaid!!code}} theme={{$:/temp/mermaid!!theme}} themeVariables={{$:/temp/mermaid!!themeVariables}} text=\\\"<<mermaid_output>>\\\" />\\n<$action-navigate $to={{$:/temp/mermaid!!save_as}} />\\n\\\\end\\n\\n\\\\define mermaid_load()\\n<$action-setfield $tiddler=\\\"$:/temp/mermaid\\\" code={{!!code}} nosync_code={{!!code}} theme={{!!theme}} themeVariables={{!!themeVariables}} advanced=\\\"false\\\" autosync=\\\"false\\\" save_as=<<currentTiddler>> />\\n<$action-navigate $to=\\\"Mermaid Editor\\\" />\\n\\\\end\"},\"$:/plugins/jmh/mermaid/macros\":{\"title\":\"$:/plugins/jmh/mermaid/macros\",\"created\":\"20211219175354029\",\"modified\":\"20211221174333360\",\"tags\":\"$:/tags/Macro\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"\\\\define mermaid_output()\\n<$importvariables filter=\\\"[[$:/plugins/jmh/mermaid/macros-internal]]\\\">\\n<div style=\\\"text-align:center\\\">\\n<div style=\\\"width: fit-content;display:inline-block\\\">\\n<$macrocall $name=\\\"mermaid_image\\\" tiddler=<<currentTiddler>> />\\n<div style=\\\"text-align:right;font-size:smaller\\\">\\n<$button class=\\\"tc-btn-invisible tc-tiddlylink\\\" actions=<<mermaid_load>>>Edit</$button>\\n</div>\\n</div>\\n</div>\\n</$importvariables>\\n\\\\end\\n\\n\\\\define mermaid_editor()\\n<style>\\n.mermaidTextEdit { width:100%; !important; }\\n.advancedDropdown { background-color:<<colour tiddler-controls-foreground>>; padding:1em }\\n</style>\\n\\n<$importvariables filter=\\\"[[$:/plugins/jmh/mermaid/macros-internal]]\\\">\\n\\n<<mermaid_editor_options>>\\n\\n<<mermaid_codebox>>\\n\\n<<mermaid_link>>\\n\\n<<mermaid_editor_advanced_toggle>>\\n\\nTarget Tiddler: <$edit-text tiddler=\\\"$:/temp/mermaid\\\" field=\\\"save_as\\\" tag=\\\"input\\\" placeholder=\\\"Name of tiddler to save\\\" /> <$button actions=<<mermaid_save>>>Save</$button>\\n<$set name=\\\"test\\\" filter=\\\"[[$:/temp/mermaid]get[save_as]is[tiddler]]\\\" value=\\\"//Existing tiddler will be overwritten//\\\" emptyValue=\\\"\\\">\\n<span style=\\\"color:red\\\"><<test>></span>\\n</$set>\\n\\n<div style=\\\"text-align:center\\\">\\n<div style=\\\"width: fit-content;display:inline-block\\\">\\n<<mermaid_image $:/temp/mermaid>>\\n</div></div>\\n</$importvariables>\\n\\\\end\"},\"$:/plugins/jmh/mermaid/readme\":{\"title\":\"$:/plugins/jmh/mermaid/readme\",\"created\":\"20211219211827538\",\"list\":\"license\",\"modified\":\"20211221174833048\",\"tags\":\"\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"!! Installation\\nDrag and drop this tiddler into your wiki, then refresh for the plugin to work:\\n\\n* $:/plugins/jmh/mermaid\\n\\n!! Motivation\\nThe idea of markdown is to allow a nicely rendered output from easy and self-descriptive syntax. [[Mermaid.js|https://mermaid-js.github.io/mermaid/#/]] extends this concept to a variety of diagrams. This plugin wraps the [[Mermaid Live Editor|https://mermaid.live/edit]] to make it easy to edit and maintain Mermaid code in your wiki while displaying the rendered output, all within a very lightweight implementation.\\n\\n!!! Internet Required\\nOne limitation of this implementation is that internet connection is required since the rendered display is pulled from the Mermaid online service. More limitations are discussed below.\\n\\n!!! Alternatives\\n* ''Use [[Mermaid Live Editor|https://mermaid.live/edit]] directly'' - this plugin embraces the Live Editor and the suggested workflow allows for moving smoothly between the in-wiki editor and Live Editor as needed\\n* ''Mermaid.js installation within TW5'' - this is the most controlled and customizable option. In my experience, the negatives are that the plugin is large (>1MB) and Mermaid rendering could be  bit buggy within TW5 and/or sometimes wouldn't play nicely with other plugins.\\n** My other critique is that the plugins I found were not actively maintained or were difficult to access for installation. [[https://efurlanm.github.io/mermaid-tw5]] seems to have addressed at least the latter.\\n\\n!! Suggested Workflow\\nThe [[Mermaid Editor]] tiddler is used to create and edit diagram tiddlers. These tiddlers contain the Mermaid syntax in fields and display the rendered result as an SVG; from here they may be transcluded as needed. The diagram display also includes a link to open the Editor to edit the diagram.\\n\\nThe [[Mermaid Editor]] tiddler is thus the center of the workflow for creating or editing diagrams.\\n\\n* Syntax is entered in the text box and this can be rendered automatically as you type (by checking \\\"auto sync\\\") or with manual refreshes.\\n* Diagram theme can also be edited by selecting from a standard \\\"Theme\\\" drop-down, or by adding `themeVariables` as an Advanced option.\\n* At any point, the current content being edited can be opened on Mermaid Live Editor via a simple link. The [[Mermaid Editor]] also allows you to paste the Mermaid Live Editor URL, which it will parse back into the wiki for you to save or continue editing diagram tiddlers.\\n\\n!! Limitations\\n* Requires internet to render diagram images, regardless of editing or viewing.\\n* This plugin wraps and is totally dependent on Mermaid Live service for rendering images. Mermaid Live Editor can itself be finnicky at times.\\n* While the wrapper of Mermaid Live is fairly generic, it does not wrap the full Mermaid API but only `code`, `theme`, and `themeVariables` to simplify complexity; anything beyond that may not be supported. If you would like to see additional features, please [[open an issue|https://github.com/jasonmhoule/tw5-mermaid/issues]].\\n\\n!! Acknowledgements\\n* This plugin relies entirely on the excellent work of the [[Mermaid.js|https://mermaid-js.github.io/mermaid/#/]] project and on the availability of the [[Mermaid Live Editor|https://mermaid.live/edit]].\\n* For base64 parsing to enable this plugin I am indebted to [[https://tobibeer.github.io/tw5-plugins/#base64]].\"},\"$:/plugins/jmh/mermaid/templates/text\":{\"title\":\"$:/plugins/jmh/mermaid/templates/text\",\"created\":\"20211219192748378\",\"modified\":\"20211221113234768\",\"tags\":\"\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"<$text text=<<currentTiddler>>/>\"},\"Mermaid Editor\":{\"title\":\"Mermaid Editor\",\"created\":\"20211210152335167\",\"modified\":\"20211221113843813\",\"tags\":\"\",\"type\":\"text/vnd.tiddlywiki\",\"text\":\"<<mermaid_editor>>\"}}}","author":"Jason Houle","core-version":">=5.1.15","created":"20211219211501983","description":"Edit and manage Mermaid.js tiddlers","list":"readme license history","modified":"20211219211828826","plugin-type":"plugin","source":"https://github.com/jasonmhoule/tw5-mermaid","tags":"","title":"$:/plugins/jmh/mermaid","version":"0.1","name":"mermaid (lite)","icon":"https://mermaid-js.github.io/mermaid/img/header.png"}