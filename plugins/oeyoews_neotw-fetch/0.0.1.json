{"title":"$:/plugins/oeyoews/neotw-fetch","description":"Neotw Fetch","author":"oeyoews","version":"0.0.1","core-version":">=5.2.5","type":"application/json","plugin-type":"plugin","name":"Neotw Fetch","dependents":"$:/plugins/oeyoews/tiddlywiki-tailwindcss-plus","list":"readme explore","text":"{\"tiddlers\":{\"$:/plugins/oeyoews/neotw-fetch/readme\":{\"title\":\"$:/plugins/oeyoews/neotw-fetch/readme\",\"text\":\"!! Neotw Fetch\\n\\n* [[Source|https://github.com/oeyoews/neotw/tree/main/plugins/oeyoews/neotw-fetch]]\\n* [[Demo|https://oeyoews.github.io/neotw]]\\n\"},\"$:/plugins/oeyoews/neotw-fetch/icon\":{\"title\":\"$:/plugins/oeyoews/neotw-fetch/icon\",\"text\":\"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"1em\\\" height=\\\"1em\\\" fill=\\\"#aaa\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"0\\\" version=\\\"1\\\" viewBox=\\\"0 0 48 48\\\"><path fill=\\\"#8BC34A\\\" stroke=\\\"none\\\" d=\\\"M39 15c0-2.2-1.8-4-4-4h-6c-.7 0-1.1-.8-.7-1.4.6-1 .9-2.2.6-3.5-.4-2-1.9-3.6-3.8-4C21.8 1.4 19 3.9 19 7c0 1 .3 1.8.7 2.6.4.6 0 1.4-.8 1.4h-6c-2.2 0-4 1.8-4 4v7c0 .7.8 1.1 1.4.7 1-.6 2.2-.9 3.5-.6 2 .4 3.6 1.9 4 3.8.7 3.2-1.8 6.1-4.9 6.1-1 0-1.8-.3-2.6-.7-.5-.4-1.3 0-1.3.7v6c0 2.2 1.8 4 4 4h22c2.2 0 4-1.8 4-4V15z\\\"/></svg>\",\"type\":\"image/svg+xml\"},\"fetch/startup.js\":{\"title\":\"fetch/startup.js\",\"text\":\"/*\\\\\\r\\ntitle: fetch/startup.js\\r\\ntype: application/javascript\\r\\nmodule-type: startup\\r\\n\\r\\nfetch-readme module\\r\\n\\r\\n\\\\*/\\r\\n// TODO: add changelog\\r\\n(function () {\\r\\n  /*jslint node: true, browser: true */\\r\\n  /*global $tw: false */\\r\\n  'use strict';\\r\\n\\r\\n  exports.name = 'fetch-readme-startup-hook';\\r\\n  exports.platforms = ['browser'];\\r\\n  exports.after = ['startup'];\\r\\n  exports.synchronous = true;\\r\\n\\r\\n  // jsdelivr.com 有缓存, 所以有时候readme 不是最新的, 使用@latest也会限制, 如果直接使用 raw GitHub readme, 会有请求速率限制\\r\\n  exports.startup = async () => {\\r\\n    const readmeURL = 'https://raw.githubusercontent.com/oeyoews/neotw/main/README.md'\\r\\n    $tw.rootWidget.addEventListener('om-fetch-mdfile', async (event) => {\\r\\n      const paramObject = event.paramObject || {};\\r\\n      const time = new Date().getTime();\\r\\n      const fileName = paramObject.fileName || `fetch-${time}`;\\r\\n      const url =\\r\\n        paramObject.url ||\\r\\n        readmeURL;\\r\\n      const response = await fetch(url);\\r\\n      const text = await response.text();\\r\\n      $tw.wiki.setText(fileName, 'text', null, text);\\r\\n      $tw.wiki.setText(fileName, 'type', null, 'text/markdown');\\r\\n    });\\r\\n\\r\\n    // if (window.location.protocol === 'http:') return;\\r\\n    const response = await fetch(readmeURL);\\r\\n    const text = await response.text();\\r\\n    const fileName = '$:/plugins/oeyoews/neotw/README';\\r\\n    $tw.wiki.setText(fileName, 'text', null, text);\\r\\n    $tw.wiki.setText(fileName, 'type', null, 'text/markdown');\\r\\n  };\\r\\n})();\\r\\n\",\"type\":\"application/javascript\",\"module-type\":\"startup\"},\"fetch-mdfile/widget\":{\"title\":\"fetch-mdfile/widget\",\"text\":\"/*\\\\\\ntitle: fetch-mdfile/widget\\ntype: application/javascript\\nmodule-type: widget\\n\\nfetch-mdfile widget\\n\\n\\\\*/\\n// TODO: refresh textContent\\n// debounce\\n(function () {\\n  /*jslint node: true, browser: true */\\n  /*global $tw: false */\\n  'use strict';\\n\\n  if (!$tw.browser) return;\\n\\n  const Widget = require('$:/core/modules/widgets/widget.js').widget;\\n\\n  class FetchWidget extends Widget {\\n    constructor(parseTreeNode, options) {\\n      super(parseTreeNode, options);\\n    }\\n\\n    render(parent, nextSibling) {\\n      this.parentDomNode = parent;\\n      this.computeAttributes();\\n      this.execute();\\n\\n      const timestamp = new Date().getTime();\\n      let filename = this.getAttribute('filename', `MDFile-${timestamp}`);\\n      filename += ' 📝';\\n      const modified = $tw.wiki.getTiddler(filename)?.fields.modified;\\n      const url = this.getAttribute(\\n        'url',\\n        'https://raw.githubusercontent.com/oeyoews/neotw/main/README.md',\\n      );\\n\\n      const buttonNode = this.document.createElement('button');\\n      buttonNode.textContent = `${filename}`;\\n      if (modified) {\\n        buttonNode.textContent = `${filename} updated ${modified}`;\\n      }\\n\\n      parent.insertBefore(buttonNode, nextSibling);\\n      this.domNodes.push(buttonNode);\\n\\n      buttonNode.onclick = async () => {\\n        NProgress.start();\\n        const response = await fetch(url);\\n        const text = await response.text();\\n        $tw.wiki.setText(filename, 'text', null, text);\\n        $tw.wiki.setText(filename, 'type', null, 'text/markdown');\\n        NProgress.done();\\n        // buttonNode.textContent = `${fileName} updated ${modified}`;\\n      };\\n    }\\n  }\\n\\n  exports['fetch-mdfile'] = FetchWidget;\\n})();\\n\",\"type\":\"application/javascript\",\"module-type\":\"widget\"}}}"}