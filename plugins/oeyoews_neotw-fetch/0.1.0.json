{"title":"$:/plugins/oeyoews/neotw-fetch","description":"Neotw Fetch","author":"oeyoews","version":"0.1.0","core-version":">=5.3.1","type":"application/json","plugin-type":"plugin","name":"Neotw Fetch","dependents":"$:/plugins/oeyoews/tiddlywiki-tailwindcss-plus","list":"readme","text":"{\"tiddlers\":{\"$:/plugins/oeyoews/neotw-fetch/readme\":{\"title\":\"$:/plugins/oeyoews/neotw-fetch/readme\",\"text\":\"!! Getfile\"},\"$:/plugins/oeyoews/neotw-fetch/addfile.js\":{\"title\":\"$:/plugins/oeyoews/neotw-fetch/addfile.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-fetch/addfile.js\\ntype: application/javascript\\nmodule-type: library\\n\\n仅支持简单的两层数据嵌套\\n\\\\*/\\nmodule.exports = (url, filename, type = 'text') => {\\n  if (!url) alert('url 为空');\\n  console.log(filename, url);\\n  fetch(url)\\n    .then((res) => {\\n      if (!res.ok) return;\\n      return res[type]();\\n    })\\n    .then((data) => {\\n      if (!data) return;\\n      if ($tw.wiki.tiddlerExists(filename)) {\\n        console.warn(`${filename} 已存在`);\\n        return;\\n      }\\n      $tw.wiki.addTiddler({\\n        title: filename,\\n        type: 'text/markdown',\\n        text: data,\\n      });\\n    });\\n};\\n\",\"type\":\"application/javascript\",\"module-type\":\"library\"},\"$:/plugins/oeyoews/neotw-fetch/startup.js\":{\"title\":\"$:/plugins/oeyoews/neotw-fetch/startup.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-fetch/startup.js\\ntype: application/javascript\\nmodule-type: startup\\n\\nfetch-readme module\\n\\\\*/\\nexports.name = 'fetch-readme-startup-hook';\\nexports.platforms = ['browser'];\\nexports.after = ['startup'];\\nexports.synchronous = true;\\n\\nexports.startup = () => {\\n  const addfile = require('./addfile');\\n\\n  const readmeURL =\\n    'https://raw.githubusercontent.com/oeyoews/neotw/main/README.md';\\n\\n  $tw.rootWidget.addEventListener('om-fetch', (event) => {\\n    const time = new Date().getTime();\\n    const {\\n      paramObject: { url = readmeURL, fileName = `fetch-${time}` } = {},\\n    } = event;\\n    addfile(url, fileName);\\n  });\\n\\n  const fileName = '$:/plugins/oeyoews/neotw/README';\\n  addfile(readmeURL, fileName);\\n};\\n\",\"type\":\"application/javascript\",\"module-type\":\"startup\"},\"$:/plugins/oeyoews/neotw-fetch/widget.js\":{\"title\":\"$:/plugins/oeyoews/neotw-fetch/widget.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-fetch/widget.js\\ntype: application/javascript\\nmodule-type: widget\\n\\nfetch-mdfile widget\\n\\\\*/\\nconst Widget = require('$:/core/modules/widgets/widget.js').widget;\\nconst addfile = require('./addfile');\\n\\nclass FetchWidget extends Widget {\\n  constructor(parseTreeNode, options) {\\n    super(parseTreeNode, options);\\n  }\\n\\n  render(parent, nextSibling) {\\n    if (!$tw.browser) return;\\n    this.parentDomNode = parent;\\n    this.computeAttributes();\\n    this.execute();\\n\\n    if (!$tw.modules.titles['nprogress.min.js']) {\\n      const notify = new $tw.Notify();\\n      notify.display({\\n        title: 'neotw-fetch',\\n        status: 'warning',\\n        autoclose: false,\\n        type: 1,\\n        text: '缺失 NProgress 插件',\\n      });\\n    }\\n    const progress = new $tw.NProgress();\\n    const timestamp = new Date().getTime();\\n\\n    const defaulturl =\\n      'https://raw.githubusercontent.com/oeyoews/neotw/main/README.md';\\n\\n    const { url = defaulturl, filename = `MDFile-${timestamp}` } =\\n      this.attributes;\\n\\n    const buttonNode = this.document.createElement('button');\\n    buttonNode.textContent = `${filename} - ${url}`;\\n\\n    parent.insertBefore(buttonNode, nextSibling);\\n    this.domNodes.push(buttonNode);\\n\\n    buttonNode.addEventListener('click', () => {\\n      progress.start();\\n      addfile(url, filename);\\n      this.refreshSelf();\\n      progress.done();\\n    });\\n  }\\n  refresh() {\\n    return false;\\n  }\\n}\\n\\nexports['fetch'] = FetchWidget;\",\"type\":\"application/javascript\",\"module-type\":\"widget\"}}}"}