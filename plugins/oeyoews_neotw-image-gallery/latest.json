{"title":"$:/plugins/oeyoews/neotw-image-gallery","description":"neotw-image-gallery","author":"oeyoews","version":"0.1.1","core-version":">=5.3.1","type":"application/json","plugin-type":"plugin","name":"neotw-image-gallery","meta#disabled":"true","dependents":"$:/plugins/oeyoews/image-observer $:/plugins/oeyoews/tiddlywiki-tailwindcss-plus","list":"readme","text":"{\"tiddlers\":{\"$:/plugins/oeyoews/neotw-image-gallery/readme\":{\"title\":\"$:/plugins/oeyoews/neotw-image-gallery/readme\",\"text\":\"## Introducion\\n\\n- 这是一个支持各种数据源的图库 (WIP), 图片已经进行按需加载优化\\n\\n* 网易云首页轮播图自动更新\\n* tiddlywiki banner(WIP)\\n* 自定义图库\\n* Bing 每日壁纸\\n* ...\\n\\n## Usage\\n\\n```wikitext\\n<$gallery json=\\\"image-list.json\\\" />\\n```\\n\\n<$gallery json=\\\"image-list.json\\\" />\\n\\n<$banners />\\n\\n<$nbanners />\\n\",\"type\":\"text/markdown\",\"description\":\"neotw-image-gallery\"},\"$:/plugins/oeyoews/neotw-image-gallery/createImage.js\":{\"title\":\"$:/plugins/oeyoews/neotw-image-gallery/createImage.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-image-gallery/createImage.js\\ntype: application/javascript\\nmodule-type: library\\n\\n\\\\*/\\n/**\\n * @function createImage\\n * @description Creates an image node.\\n * @param {string} title - The title of the image.\\n * @param {string} src - The source URL of the image.\\n * @returns {HTMLImageElement} The created image node.\\n */\\nmodule.exports = function createImage(title, src, standard = true) {\\n  const createElement = $tw.utils.domMaker;\\n\\n  const imageNode = createElement('img', {\\n    class: `object-cover w-full h-full spotlight rounded-md group-hover:scale-105 transition-all duration-800 ease-in-out shadow-md aspect-video`,\\n    attributes: {\\n      ['data-src']: src,\\n      title,\\n      loading: 'lazy'\\n    }\\n  });\\n\\n  standard === 'false' && imageNode.classList.remove('aspect-video');\\n  imageNode.addEventListener('contextmenu', (e) => {\\n    e.preventDefault();\\n  });\\n\\n  return imageNode;\\n};\\n\",\"type\":\"application/javascript\",\"module-type\":\"library\"},\"$:/plugins/oeyoews/neotw-image-gallery/netease-fetcher.js\":{\"title\":\"$:/plugins/oeyoews/neotw-image-gallery/netease-fetcher.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-image-gallery/netease-fetcher.js\\ntype: application/javascript\\nmodule-type: library\\n\\n\\\\*/\\n\\n// TODO: add error catch\\n// TODO: 封装一个 fetch\\n/**\\n * @description 网易云 banner 模块\\n * @returns {Array} An array of banner objects with a `src` property containing the URL of each banner image.\\n */\\nconst getbanners = async () => {\\n  const api = 'https://react-music-api-coral.vercel.app/api/banner';\\n  const res = await fetch(api);\\n  const data = await res.json();\\n  const { banners } = data.body;\\n  return banners.map((banner) => ({ src: banner.pic }));\\n};\\n\\nmodule.exports = getbanners;\\n\",\"type\":\"application/javascript\",\"module-type\":\"library\"},\"$:/plugins/oeyoews/neotw-image-gallery/netease-banners.js\":{\"title\":\"$:/plugins/oeyoews/neotw-image-gallery/netease-banners.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-image-gallery/netease-banners.js\\ntype: application/javascript\\nmodule-type: widget\\n\\nneotw-image-gallery widget\\n\\n\\\\*/\\nconst { widget: Widget } = require('$:/core/modules/widgets/widget.js');\\nconst createImage = require('./createImage');\\nconst neteasefetcher = require('./netease-fetcher');\\n\\nclass BannersWidget extends Widget {\\n  constructor(parseTreeNode, options) {\\n    super(parseTreeNode, options);\\n  }\\n\\n  async render(parent, nextSibling) {\\n    if (!$tw.browser) return;\\n    this.parentDomNode = parent;\\n    this.computeAttributes();\\n    this.execute();\\n    const createElement = $tw.utils.domMaker;\\n    // NOTE: tw 支持基于 tw 内部路由，但是仅仅支持 js with module-type library(json not support)\\n    // const twimageobserver = require('$:/plugins/oeyoews/neotw-notion-gallery/twimageobserver.js');\\n    // const twimageobserver = require('../neotw-notion-gallery/twimageobserver.js');\\n\\n    const { observer } = new $tw.ImageObserver();\\n\\n    const loading = createElement('div', {\\n      class: 'bg-gray-200 rounded w-full h-48 animate-pulse'\\n    });\\n    parent.insertBefore(loading, nextSibling);\\n    this.domNodes.push(loading);\\n\\n    const data = await neteasefetcher();\\n    this.removeChildDomNodes(loading);\\n\\n    const children = [];\\n\\n    data.slice(0, 9).forEach(({ src }) => {\\n      const imageNode = createImage('', src, 'false');\\n      observer.observe(imageNode);\\n      children.push(imageNode);\\n    });\\n\\n    const domNode = createElement('div', {\\n      class: 'grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4',\\n      children\\n    });\\n    parent.insertBefore(domNode, nextSibling);\\n    this.domNodes.push(domNode);\\n  }\\n}\\n\\n/**\\n * @description neotw-image-gallery widget\\n * @param {json}\\n */\\nexports.nbanners = BannersWidget;\\n\",\"type\":\"application/javascript\",\"module-type\":\"widget\"},\"$:/plugins/oeyoews/neotw-image-gallery/tiddlywiki-banners.js\":{\"title\":\"$:/plugins/oeyoews/neotw-image-gallery/tiddlywiki-banners.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-image-gallery/tiddlywiki-banners.js\\ntype: application/javascript\\nmodule-type: widget\\n\\nneotw-image-gallery widget\\n\\n\\\\*/\\nconst { widget: Widget } = require('$:/core/modules/widgets/widget.js');\\nconst createImage = require('./createImage');\\n\\nclass BannersWidget extends Widget {\\n  constructor(parseTreeNode, options) {\\n    super(parseTreeNode, options);\\n  }\\n\\n  render(parent, nextSibling) {\\n    if (!$tw.browser) return;\\n    this.parentDomNode = parent;\\n    this.computeAttributes();\\n    this.execute();\\n\\n    const { observer } = new $tw.ImageObserver();\\n    const createElement = $tw.utils.domMaker;\\n\\n    const children = [];\\n\\n    // https://cdn.jsdelivr.net/gh/oeyoews/tiddlywiki-starter-kit@main/plugins/oeyoews/tiddlywiki-banners/files/523.png?raw=true\\n    const imageProvider = 'https://cdn.jsdelivr.net/gh';\\n    const repo = 'oeyoews/tiddlywiki-starter-kit@main';\\n    const path = 'plugins/oeyoews/tiddlywiki-banners/files';\\n    const urlPrefix = `${imageProvider}/${repo}/${path}`;\\n    const versions = [520, 523, 530, 532];\\n\\n    const imageURLs = versions.map((version) => ({\\n      title: version,\\n      src: `${urlPrefix}/${version}.png?raw=true`\\n    }));\\n\\n    imageURLs.forEach(({ title, src }) => {\\n      const imageNode = createImage(title, src);\\n      observer.observe(imageNode);\\n      children.push(imageNode);\\n    });\\n\\n    const domNode = createElement('div', {\\n      class: 'grid grid-cols-1 md:grid-cols-3 gap-4',\\n      children\\n    });\\n\\n    parent.insertBefore(domNode, nextSibling);\\n    this.domNodes.push(domNode);\\n  }\\n}\\n\\n/**\\n * @description neotw-image-gallery widget\\n * @param {json}\\n */\\nexports.banners = BannersWidget;\\n\",\"type\":\"application/javascript\",\"module-type\":\"widget\"},\"$:/plugins/oeyoews/neotw-image-gallery/widget.js\":{\"title\":\"$:/plugins/oeyoews/neotw-image-gallery/widget.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-image-gallery/widget.js\\ntype: application/javascript\\nmodule-type: widget\\n\\nneotw-image-gallery widget\\n\\n\\\\*/\\nconst { widget: Widget } = require('$:/core/modules/widgets/widget.js');\\nconst createImage = require('./createImage');\\n\\nclass GalleryWidget extends Widget {\\n  constructor(parseTreeNode, options) {\\n    super(parseTreeNode, options);\\n    this.jsonfile = null;\\n  }\\n\\n  render(parent, nextSibling) {\\n    if (!$tw.browser) return;\\n    this.parentDomNode = parent;\\n    this.computeAttributes();\\n    this.execute();\\n\\n    const { observer } = new $tw.ImageObserver();\\n\\n    const createElement = $tw.utils.domMaker;\\n    const { json = 'image-list.json' } = this.attributes;\\n    this.jsonfile = json;\\n\\n    // need check this file\\n    const isFile = $tw.wiki.tiddlerExists(json);\\n    if (!isFile) {\\n      console.warn(json, 'file not founded !');\\n      return;\\n    }\\n    const data = $tw.wiki.getTiddlerData(json);\\n    const imagesURL = Object.entries(data);\\n\\n    const children = [];\\n\\n    imagesURL.forEach(([title, src]) => {\\n      const imageNode = createImage(title, src);\\n      observer.observe(imageNode);\\n      children.push(imageNode);\\n    });\\n\\n    const domNode = createElement('div', {\\n      class: 'grid grid-cols-1 md:grid-cols-3 gap-4',\\n      children\\n    });\\n\\n    parent.insertBefore(domNode, nextSibling);\\n    this.domNodes.push(domNode);\\n  }\\n\\n  refresh(changedTiddlers) {\\n    if (Object.keys(changedTiddlers).includes(this.jsonfile)) {\\n      this.refreshSelf();\\n      return true;\\n    } else {\\n      return false;\\n    }\\n  }\\n}\\n\\n/**\\n * @description neotw-image-gallery widget\\n * @param {json}\\n */\\nexports.gallery = GalleryWidget;\\n\",\"type\":\"application/javascript\",\"module-type\":\"widget\"}}}"}