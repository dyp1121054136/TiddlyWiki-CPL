{"title":"$:/plugins/oeyoews/neotw-tw-bot","description":"快速记录你的想法","author":"oeyoews","version":"0.0.1","core-version":">=5.3.0","type":"application/json","plugin-type":"plugin","name":"Neotw Tw Bot","dependents":"$:/plugins/oeyoews/tiddlywiki-tailwindcss-plus","list":"readme","text":"{\"tiddlers\":{\"$:/plugins/oeyoews/neotw-tw-bot/Action\":{\"title\":\"$:/plugins/oeyoews/neotw-tw-bot/Action\",\"tags\":\"$:/tags/StartupAction/PostRender\",\"text\":\"<$list filter=\\\"[{$:/info/url/search}match[?layout=neotw-tw-bot]]\\\">\\n  <$action-setfield $tiddler=\\\"$:/layout\\\" text=\\\"$:/plugins/oeyoews/neotw-tw-bot/Layout\\\"/>\\n</$list>\"},\"$:/plugins/oeyoews/neotw-tw-bot/Layout\":{\"title\":\"$:/plugins/oeyoews/neotw-tw-bot/Layout\",\"tags\":\"$:/tags/Layout\",\"name\":\"{{$:/plugins/oeyoews/neotw-tw-bot/icon}}\",\"description\":\"{{$:/plugins/oeyoews/neotw-tw-bot/readme!!description}}\",\"text\":\"\\\\import [[$:/core/ui/PageMacros]] [all[shadows+tiddlers]tag[$:/tags/Macro]!has[draft.of]]\\n\\n<$vars\\n\\ttv-config-toolbar-icons={{$:/config/Toolbar/Icons}}\\n\\ttv-config-toolbar-text={{$:/config/Toolbar/Text}}\\n\\ttv-config-toolbar-class={{$:/config/Toolbar/ButtonClass}}\\n\\ttv-enable-drag-and-drop={{$:/config/DragAndDrop/Enable}}\\n\\ttv-show-missing-links={{$:/config/MissingLinks}}\\n\\tstoryviewTitle={{$:/view}}\\n\\tlanguageTitle={{{ [{$:/language}get[name]] }}}>\\n\\n<div class=\\\"prose max-w-none prose-indigo m-auto sm:w-auto md:w-2/3\\\">\\n  {{{ [[$:/plugins/oeyoews/neotw-tw-bot/readme]] ||$:/core/ui/ViewTemplate }}}\\n</div>\"},\"$:/plugins/oeyoews/neotw-tw-bot/readme\":{\"title\":\"$:/plugins/oeyoews/neotw-tw-bot/readme\",\"description\":\"neotw-tw-bot\",\"text\":\"{{$:/languages/neotw-tw-bot/readme}}\\n\"},\"$:/plugins/oeyoews/neotw-tw-bot/caption\":{\"title\":\"$:/plugins/oeyoews/neotw-tw-bot/caption\",\"text\":\"\\\\whitespace trim\\n<h2 class=\\\"tc-title\\\">\\n  <$view field=\\\"caption\\\" />\\n</h2>\\n\"},\"$:/plugins/oeyoews/neotw-tw-bot/caption-filter\":{\"title\":\"$:/plugins/oeyoews/neotw-tw-bot/caption-filter\",\"tags\":\"$:/tags/ViewTemplateTitleFilter\",\"list-before\":\"$:/config/ViewTemplateTitleFilters/default\",\"text\":\"[<currentTiddler>creator[tw-bot]has[caption]then[$:/plugins/oeyoews/neotw-tw-bot/caption]]\\n\"},\"$:/plugins/oeyoews/neotw-tw-bot/icon\":{\"title\":\"$:/plugins/oeyoews/neotw-tw-bot/icon\",\"text\":\"<svg fill=\\\"none\\\" height=\\\"32\\\" viewBox=\\\"0 0 32 32\\\" width=\\\"32\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><path d=\\\"m5 3.5c0 .65311-.4174 1.20873-1 1.41465v7.08535l2.16075 5.4867-2.16075 5.5133c-1.1 0-2-.8992-2-1.9982v-7.0036c0-.7357.40334-1.3819 1-1.7287v-7.35485c-.5826-.20592-1-.76154-1-1.41465 0-.82843.67157-1.5 1.5-1.5s1.5.67157 1.5 1.5z\\\" fill=\\\"#f8312f\\\"/><path d=\\\"m30.0499 3.55c0 .68107-.4392 1.25955-1.0499 1.46757v7.18223c.5967.3471 1 .9939 1 1.7303v7.01c0 1.1-.9 2-2 2l-2.9405-5.6792 2.9405-5.3308v-6.9125c-.6107-.20799-1.05-.78649-1.05-1.4676 0-.85604.6939-1.55 1.55-1.55.856 0 1.5499.69396 1.5499 1.55z\\\" fill=\\\"#f8312f\\\"/><path d=\\\"m11 4.5c0-.82843.6716-1.5 1.5-1.5h7c.8284 0 1.5.67157 1.5 1.5 0 .67932-.4516 1.25317-1.0709 1.43774-.2765.08238-.5696.10387-.8462.18581l-3.053.90437-3.1191-.90828c-.2725-.07936-.5607-.10013-.8331-.1799-.6228-.18238-1.0777-.75794-1.0777-1.43974z\\\" fill=\\\"#ffb02e\\\"/><path d=\\\"m22.05 30h-12.1c-3.29 0-5.95-2.66-5.95-5.95v-12.02c0-3.33 2.7-6.03 6.03-6.03h11.95c3.32 0 6.02 2.7 6.02 6.03v12.03c0 3.28-2.66 5.94-5.95 5.94z\\\" fill=\\\"#cdc4d6\\\"/><path d=\\\"m9.24738 18.5h13.50522c2.3296 0 4.2474-1.919 4.2474-4.25 0-2.341-1.9078-4.25-4.2474-4.25h-13.50522c-2.33958 0-4.24738 1.909-4.24738 4.25s1.9078 4.25 4.24738 4.25z\\\" fill=\\\"#212121\\\"/><path d=\\\"m13.4718 26h5.0564c.811 0 1.4718-.6735 1.4718-1.5s-.6608-1.5-1.4718-1.5h-5.0564c-.811 0-1.4718.6735-1.4718 1.5s.6608 1.5 1.4718 1.5z\\\" fill=\\\"#212121\\\"/><g fill=\\\"#00a6ed\\\"><path d=\\\"m10.25 12c-.69036 0-1.25.5596-1.25 1.25v2.5c0 .6904.55964 1.25 1.25 1.25.6904 0 1.25-.5596 1.25-1.25v-2.5c0-.6904-.5596-1.25-1.25-1.25z\\\"/><path d=\\\"m21.75 12c-.6904 0-1.25.5596-1.25 1.25v2.5c0 .6904.5596 1.25 1.25 1.25s1.25-.5596 1.25-1.25v-2.5c0-.6904-.5596-1.25-1.25-1.25z\\\"/></g></svg>\",\"type\":\"image/svg+xml\"},\"$:/languages/neotw-tw-bot/readme\":{\"title\":\"$:/languages/neotw-tw-bot/readme\",\"text\":\"<div class=\\\"prose max-w-none prose-indigo\\\">\\n\\n<$tw-bot />\\n\\n!! 用法\\n\\n```\\n<$tw-bot />\\n```\\n\\n> 快速记录想法,单行模式直接回车或者点击发送按钮即可\\n\\n!! 配置\\n\\n* <$button class=\\\"p-2 bg-indigo-300/60\\\">\\n  🩹 放置在侧边栏\\n  <$action-listops  $tiddler=\\\"$:/plugins/oeyoews/neotw-tw-bot/tw-bot.tid\\\" $tags=\\\"+[toggle[$:/tags/SideBar]]\\\" />\\n</$button>\\n* <$button class=\\\"p-2 bg-purple-300/60\\\">\\n  🩹 放置在控制栏\\n  <$action-listops  $tiddler=\\\"$:/plugins/oeyoews/neotw-tw-bot/ui\\\" $tags=\\\"+[toggle[$:/tags/PageControls]]\\\" />\\n</$button>\\n\\n<!-- * 生成条目的固定格式为 `<creator>-<tag>-<timestamp>` -->\\n* 自动选取文本内容的前五个字符作为标题\\n* <$button class=\\\"p-2 bg-rose-500\\\">\\n重置 🛺\\n<$action-deletetiddler $filter=\\\"[[$:/plugins/oeyoews/neotw-tw-bot/tags.json]]\\\"/>\\n</$button>\\n* 生成的每个条目都有 `creator` 字段, 默认值是 `tw-bot`, 支持更改 [[creator👉|$:/plugins/oeyoews/neotw-tw-bot/tags.json]]\\n* 生成的每个条目都有 `tag` 字段, 支持更改 [[tag👉|$:/plugins/oeyoews/neotw-tw-bot/tags.json]]\\n* <$button class=\\\"bg-rose-400 p-2 rounded\\\">\\n 🔥 删除此插件产生的所有记录条目\\n  <$action-deletetiddler $filter=\\\"[prefix[tw-bot/messages/]creator[tw-bot]]\\\"/>\\n</$button>\\n\\n!! 可选样式美化插件\\n\\n> 本插件默认采用零样式, 如果安装了下面插件, 则自动采用相关美化样式,建议安装\\n\\n* tailwindcss: 样式依赖\\n* swal2: 通知依赖\\n* modal: 弹窗依赖\\n\\n</div>\"},\"$:/plugins/oeyoews/neotw-tw-bot/popup-widget.js\":{\"title\":\"$:/plugins/oeyoews/neotw-tw-bot/popup-widget.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-tw-bot/popup-widget.js\\ntype: application/javascript\\nmodule-type: widget\\n\\nneotw-tw-bot widget\\n\\n\\\\*/\\n(function () {\\n  /*jslint node: true, browser: true */\\n  /*global $tw: false */\\n  'use strict';\\n  // 是$:/plugins/oeyoews/neotw-tw-bot/sendmessage.js 的简写, 和真实文件路径无关, 但最好相同, 方便编辑器识别, 就不用写.js 后缀\\n  const twBot = require('./sendmessage');\\n\\n  const Widget = require('$:/core/modules/widgets/widget.js').widget;\\n\\n  class TwBot extends Widget {\\n    constructor(parseTreeNode, options) {\\n      super(parseTreeNode, options);\\n      this.virtualRoot = null;\\n    }\\n\\n    render(parent, nextSibling) {\\n      if (!$tw.browser) return;\\n      this.virtualRoot = twBot();\\n\\n      const container = document.createElement('div');\\n      const span = document.createElement('span');\\n      span.innerHTML = $tw.wiki.getTiddlerText(\\n        '$:/plugins/oeyoews/neotw-tw-bot/icon',\\n      );\\n      span.classList.add('cursor-pointer');\\n      span.addEventListener('click', () => {\\n        botNode.classList.remove('scale-0');\\n        masklayer.classList.remove('scale-0');\\n      });\\n      container.appendChild(span);\\n      const masklayer = document.createElement('div');\\n      masklayer.className =\\n        'fixed inset-0 bg-black/10 backdrop-blur z-[9998] cursor-pointer scale-0';\\n      masklayer.addEventListener('click', () => {\\n        botNode.classList.add('scale-0');\\n        masklayer.classList.add('scale-0');\\n      });\\n      const botNode = document.createElement('div');\\n      botNode.className =\\n        'fixed top-8 -translate-x-1/2 left-1/2 w-full z-[9999] transition-all duration-300 ease-in-out scale-0';\\n      botNode.appendChild(this.virtualRoot);\\n      container.appendChild(masklayer);\\n      container.appendChild(botNode);\\n\\n      this.parentDomNode = parent;\\n      this.computeAttributes();\\n      this.execute();\\n\\n      parent.insertBefore(container, nextSibling);\\n      this.domNodes.push(container);\\n    }\\n\\n    refresh() {\\n      this.refreshSelf();\\n    }\\n  }\\n\\n  exports['tw-bot-popup'] = TwBot;\\n})();\",\"type\":\"application/javascript\",\"module-type\":\"widget\"},\"$:/plugins/oeyoews/neotw-tw-bot/send.svg\":{\"title\":\"$:/plugins/oeyoews/neotw-tw-bot/send.svg\",\"text\":\"<svg class=\\\"fill-zinc-400\\\" stroke=\\\"currentColor\\\" fill=\\\"currentColor\\\" stroke-width=\\\"0\\\" t=\\\"1569683742680\\\" viewBox=\\\"0 0 1024 1024\\\" version=\\\"1.1\\\" height=\\\"1em\\\" width=\\\"1em\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><defs></defs><path d=\\\"M931.4 498.9L94.9 79.5c-3.4-1.7-7.3-2.1-11-1.2-8.5 2.1-13.8 10.7-11.7 19.3l86.2 352.2c1.3 5.3 5.2 9.6 10.4 11.3l147.7 50.7-147.6 50.7c-5.2 1.8-9.1 6-10.3 11.3L72.2 926.5c-0.9 3.7-0.5 7.6 1.2 10.9 3.9 7.9 13.5 11.1 21.5 7.2l836.5-417c3.1-1.5 5.6-4.1 7.2-7.1 3.9-8 0.7-17.6-7.2-21.6zM170.8 826.3l50.3-205.6 295.2-101.3c2.3-0.8 4.2-2.6 5-5 1.4-4.2-0.8-8.7-5-10.2L221.1 403 171 198.2l628 314.9-628.2 313.2z\\\"></path></svg>\\n\",\"type\":\"image/svg+xml\"},\"$:/plugins/oeyoews/neotw-tw-bot/sendmessage.js\":{\"title\":\"$:/plugins/oeyoews/neotw-tw-bot/sendmessage.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-tw-bot/sendmessage.js\\ntype: application/javascript\\nmodule-type: library\\n\\n\\\\*/\\nmodule.exports = function twBot() {\\n  const tagsDict = $tw.wiki.getTiddlerData(\\n    '$:/plugins/oeyoews/neotw-tw-bot/tags.json',\\n  );\\n  const tags = Object.entries(tagsDict)\\n    .filter(([creator]) => creator !== 'creator')\\n    .map(([tag, color]) => ({\\n      tag,\\n      color,\\n    }));\\n  const selectedTag = localStorage.getItem('selectedTag');\\n  const defaultTag = selectedTag || tags[0].tag; // 如果localStorage中没有存储标签，则使用第一个标签作为默认标签\\n  const selectTag = document.createElement('select');\\n  const tagCount = document.createElement('span');\\n  const tagCountText = $tw.wiki.filterTiddlers(`[tag[${defaultTag}]]`).length;\\n  tagCount.classList.add('text-gray-400', '-ml-1', '-mt-2');\\n  tagCount.textContent = tagCountText ? tagCountText : '';\\n  selectTag.classList.add(\\n    'text-white',\\n    'appearance-none',\\n    'border-none',\\n    'p-1',\\n    'ml-2',\\n    'font-bold',\\n    'rounded-full',\\n    'cursor-pointer',\\n    'bg-transparent',\\n    `text-${tagsDict[defaultTag]}-400`,\\n  );\\n  selectTag.addEventListener('change', function () {\\n    tagCount.textContent = $tw.wiki.filterTiddlers(\\n      `[tag[${selectTag.value}]]`,\\n    ).length;\\n    // 移除以\\\"bg-\\\"开头的类名\\n    localStorage.setItem('selectedTag', selectTag.value);\\n    selectTag.classList.forEach((className) => {\\n      if (className.startsWith('text-')) {\\n        selectTag.classList.remove(className);\\n      }\\n    });\\n    // add new color\\n    selectTag.classList.add(`text-${tagsDict[selectTag.value]}-400`);\\n  });\\n  tags.forEach(({ tag, color }) => {\\n    const option = document.createElement('option');\\n    option.value = tag;\\n    option.text = tag;\\n    option.classList.add(`text-${color}-300`, 'font-bold');\\n    if (tag === defaultTag) {\\n      option.selected = true; // 设置默认选中标签\\n      // need listener\\n      // selectTag.classList.add(`bg-${color}-400`);\\n    }\\n    selectTag.appendChild(option);\\n  });\\n\\n  // 直接使用fakeDocument会报错\\n  const form = document.createElement('form');\\n  form.classList.add(\\n    'p-1',\\n    'flex',\\n    'justify-between',\\n    'max-w-xl',\\n    'mx-auto',\\n    'border-none',\\n    'rounded-full',\\n    'bg-black',\\n  );\\n\\n  const button = document.createElement('button');\\n\\n  const sendIcon = $tw.wiki.getTiddlerText(\\n    '$:/plugins/oeyoews/neotw-tw-bot/send.svg',\\n  );\\n  button.innerHTML = sendIcon;\\n  button.classList.add(\\n    'p-2',\\n    'mx-2',\\n    'bg-transparent',\\n    'scale-125',\\n    'hover:scale-150',\\n    'transition',\\n    'cursor-not-allowed',\\n    'rounded-full',\\n  );\\n  button.title = 'send';\\n  button.disabled = true; // 不需要使用readonly\\n  const inputMessage = document.createElement('input');\\n  // bug\\n  // inputMessage.setAttribute(\\\"autofocus\\\", true);\\n  inputMessage.classList.add(\\n    'w-full',\\n    'border-none',\\n    'placeholder-zinc-400',\\n    'bg-transparent',\\n    'caret-indigo-500',\\n    'shadow-none',\\n    'text-white',\\n  );\\n  inputMessage.placeholder = `任何${tags.map(({ tag }) => tag).join(',')}`;\\n  inputMessage.addEventListener('input', function () {\\n    // 检查输入框的值是否为空，然后设置按钮的禁用状态\\n    // inputMessage.classList.add(`bg-${tagsDict[selectTag.value]}-300`);\\n    button.disabled = !inputMessage.value;\\n    if (button.disabled) {\\n      button.classList.add('cursor-not-allowed');\\n    } else {\\n      button.classList.remove('cursor-not-allowed');\\n    }\\n  });\\n  form.appendChild(selectTag);\\n  // form.appendChild(tagCount);\\n  form.appendChild(inputMessage);\\n  form.appendChild(button);\\n\\n  form.addEventListener('submit', (e) => {\\n    e.preventDefault();\\n    sentMessage(selectTag.value);\\n  });\\n\\n  const timestamp = new Date().toISOString().replace(/\\\\D/g, '');\\n\\n  const options = {\\n    created: timestamp,\\n    modified: timestamp,\\n    creator: tagsDict.creator,\\n  };\\n\\n  function sentMessage(tag) {\\n    const tags = tag;\\n    // create new tiddler\\n    $tw.wiki.addTiddler({\\n      title: `${options.creator}-${tag}-${timestamp}`,\\n      // title: inputMessage.value.slice(0, 5),\\n      text: inputMessage.value,\\n      caption: inputMessage.value.slice(0, 7),\\n      tags,\\n      ...options,\\n    });\\n    // 需要await\\n    // inputMessage.value = \\\"\\\";\\n    // 统计当天记录的想法数量\\n    const count = $tw.wiki.filterTiddlers(\\n      `[creator[${options.creator}]days[-1]]`,\\n    ).length;\\n\\n    function createAndDisplayNotification(count) {\\n      const tempTiddler = '$:/temp/tw-bot/notify';\\n      $tw.wiki.addTiddler({\\n        title: tempTiddler,\\n        text: `这是你今天的第 ${count} 条记录`,\\n      });\\n      $tw.notifier.display(tempTiddler);\\n    }\\n\\n    typeof Swal !== 'undefined'\\n      ? Swal.fire({\\n          icon: 'success',\\n          title: `这是你今天的第 ${count} 条记录`,\\n          showConfirmButton: false,\\n          timer: 1500,\\n          toast: true,\\n          position: 'top-end',\\n        })\\n      : createAndDisplayNotification(count);\\n  }\\n  return form;\\n};\\n\",\"type\":\"application/javascript\",\"module-type\":\"library\"},\"$:/plugins/oeyoews/neotw-tw-bot/tw-bot.tid\":{\"title\":\"$:/plugins/oeyoews/neotw-tw-bot/tw-bot.tid\",\"caption\":\"记录一闪而过的瞬间\",\"icon\":\"$:/plugins/oeyoews/neotw-tw-bot/icon\",\"mask-closable\":\"yes\",\"class\":\"o-tm\",\"subtitle\":\"{{$:/plugins/oeyoews/tiddlywiki-modal-ui/close-modal}}\",\"text\":\"<!-- caption: {{$:/plugins/oeyoews/neotw-tw-bot/icon}} 记录一闪而过的瞬间 -->\\n<!-- tags: $:/tags/SideBar -->\\n\\n<div class=\\\"my-4\\\">\\n  <$tw-bot />\\n</div>\\n\\n<!-- use grid -->\\n<div class=\\\"space-y-4\\\">\\n<$list filter=\\\"[creator[tw-bot]days[-1]!sort[created]limit[3]]\\\" variable=\\\"tiddler\\\">\\n<div class=\\\"rounded p-2\\\">\\n  <$macrocall $name=\\\"translink\\\" title={{{ [<tiddler>] }}}}/>\\n</div>\\n</$list>\"},\"$:/plugins/oeyoews/neotw-tw-bot/tags.json\":{\"text\":\"{\\n  \\\"creator\\\": \\\"tw-bot\\\",\\n  \\\"一言\\\": \\\"indigo\\\",\\n  \\\"想法\\\": \\\"blue\\\",\\n  \\\"任务\\\": \\\"green\\\",\\n  \\\"工作\\\": \\\"yellow\\\",\\n  \\\"生活\\\": \\\"orange\\\",\\n  \\\"其他\\\": \\\"red\\\"\\n}\\n\",\"type\":\"application/json\",\"title\":\"$:/plugins/oeyoews/neotw-tw-bot/tags.json\"},\"$:/plugins/oeyoews/neotw-tw-bot/ui\":{\"title\":\"$:/plugins/oeyoews/neotw-tw-bot/ui\",\"list-before\":\"$:/core/ui/Buttons/more-page-actions\",\"description\":\"call tw-bot\",\"caption\":\"TwBot\",\"text\":\"<!-- tags: $:/tags/PageControls -->\\n\\n\\\\whitespace trim\\n<$button tooltip=\\\"tw-bot\\\" aria-label=\\\"tw-bot\\\" class=<<tv-config-toolbar-class>>>\\n<$list filter=\\\"[<tv-config-toolbar-icons>match[yes]]\\\">\\n<$action-sendmessage $message=\\\"tm-modal\\\" $param=\\\"$:/plugins/oeyoews/neotw-tw-bot/tw-bot.tid\\\"/>\\n{{$:/plugins/oeyoews/neotw-tw-bot/icon}}\\n</$list>\\n<$list filter=\\\"[<tv-config-toolbar-text>match[yes]]\\\">\\n<span class=\\\"tc-btn-text\\\">\\n<$text text=\\\"tw-bot\\\"/>\\n</span>\\n</$list>\\n</$button>\"},\"$:/plugins/oeyoews/neotw-tw-bot/widget.js\":{\"title\":\"$:/plugins/oeyoews/neotw-tw-bot/widget.js\",\"text\":\"/*\\\\\\ntitle: $:/plugins/oeyoews/neotw-tw-bot/widget.js\\ntype: application/javascript\\nmodule-type: widget\\n\\nneotw-tw-bot widget\\n\\n\\\\*/\\n(function () {\\n  /*jslint node: true, browser: true */\\n  /*global $tw: false */\\n  'use strict';\\n  // 是$:/plugins/oeyoews/neotw-tw-bot/sendmessage.js 的简写, 和真实文件路径无关, 但最好相同, 方便编辑器识别, 就不用写.js 后缀\\n  const twBot = require('./sendmessage');\\n\\n  const Widget = require('$:/core/modules/widgets/widget.js').widget;\\n\\n  class TwBot extends Widget {\\n    constructor(parseTreeNode, options) {\\n      super(parseTreeNode, options);\\n      this.virtualRoot = null;\\n    }\\n\\n    render(parent, nextSibling) {\\n      if (!$tw.browser) return;\\n      this.virtualRoot = twBot();\\n\\n      this.parentDomNode = parent;\\n      this.computeAttributes();\\n      this.execute();\\n\\n      parent.insertBefore(this.virtualRoot, nextSibling);\\n      this.domNodes.push(this.virtualRoot);\\n    }\\n\\n    refresh() {\\n      this.refreshSelf();\\n    }\\n  }\\n\\n  exports['tw-bot'] = TwBot;\\n})();\\n\",\"type\":\"application/javascript\",\"module-type\":\"widget\"}}}"}